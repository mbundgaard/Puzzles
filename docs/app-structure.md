# App Structure

## Routes (`app/src/routes/`)

| Route | Description |
|-------|-------------|
| `/` | Home page with game grid |
| `/spil/[game]` | Dynamic game page |
| `/leaderboard` | Leaderboard page |
| `/feedback` | Feedback submission page |
| `/settings` | Settings (language, about, changelog) |

## Layout (`+layout.svelte`)

The root layout provides:
- Animated background (pulsing gradient orbs)
- Header that hides on scroll down, shows on scroll up
- Bottom tab bar navigation (also hides/shows on scroll)
- Language initialization from localStorage

## Home Page (`+page.svelte`)

- **Header**: Title "Hjernespil" / "Brain Games" with gradient text
- **Game grid**: Cards with icon, title, description
  - Glassmorphism background
  - Sorted by most recent activity
  - Badges for new/updated games (auto-calculated)
- **Modals**: QR share, About, Changelog

## Components (`app/src/lib/components/`)

| Component | Description |
|-----------|-------------|
| `Header.svelte` | Home page header with title and action buttons |
| `PageHeader.svelte` | Reusable header for subpages |
| `BottomTabBar.svelte` | Navigation tabs (Games, Leaderboard, Feedback, Settings) |
| `GameCard.svelte` | Game card for home grid |
| `AboutModal.svelte` | About the app modal |
| `ChangelogModal.svelte` | What's new modal |
| `ShareQRModal.svelte` | QR code sharing modal |
| `UpdateBanner.svelte` | Toast notifications for version updates |

## PWA Support

The app is configured as a Progressive Web App using `@vite-pwa/sveltekit`:

- **Service Worker** - Generated by Workbox, precaches all static assets for offline support
- **Manifest** - Generated by vite-pwa plugin (configured in `vite.config.js`)
- **Icons** - `app/static/icons/` - App icons for various sizes
- **Meta tags** - iOS/Android PWA meta tags in `app.html`

## App Version System

The app uses a simple timestamp-based version system stored in `app/src/lib/version.ts`:

```typescript
export const APP_VERSION = 1768043703; // Unix timestamp in seconds
```

### How Updates Work

1. **Return from game** - App checks server version silently. If new version exists, reloads and shows "Updated!" toast.
2. **Pull to refresh** - User pulls down on home screen. App checks server version:
   - If update available: reloads page, shows "Updated!" toast
   - If no update: shows "Already updated" toast

### Version Endpoints

| Endpoint | Description |
|----------|-------------|
| `POST /api/version` | Check if update exists: `{version}` → `{newVersionExists}` |
| `POST /api/version/set` | Set server version: `{version}` → `{success, version}` |

### Key Files

| File | Description |
|------|-------------|
| `app/src/lib/version.ts` | App version (Unix timestamp) |
| `app/src/lib/api.ts` | `checkForUpdates()` function |
| `UpdateBanner.svelte` | Toast component for update messages |

## Styling Guidelines

- Modern gaming/app aesthetic with dark theme
- Glassmorphism effects (blur, transparency, subtle borders)
- Responsive design for mobile and desktop
- Color palette: Dark backgrounds (#0f0f23), purple/magenta/cyan accents, white text
- Poppins font for modern feel
- Animated elements and smooth transitions
- Clear visual feedback for interactions (scale on tap, color accents)

## README Game Tracking

The README.md contains a games table with these columns:

| Column | Description |
|--------|-------------|
| # | Game folder number (01-99) |
| Game | Link to game folder |
| Points | Points awarded for winning (e.g., "3" or "1/2/3" for difficulty levels) |
| Created | Date game was first added (YYYY-MM-DD format) |
| Updated | Date game was last significantly updated (YYYY-MM-DD format, empty if never updated) |
| Description | Brief description of the game |

### When to Update Dates

- **Created**: Set to today's date when adding a new game
- **Updated**: Set to today's date when making significant changes to an existing game:
  - Bug fixes that affect gameplay
  - New features or difficulty levels
  - UI/UX improvements
  - Do NOT update for minor fixes (typos, small style tweaks)
